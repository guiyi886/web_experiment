<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <title>用户注册</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="http://172.31.73.236/resource/css/8-1.css"/>

  <script src="http://172.31.73.236/assets/crypto-js.min.js"></script>
  <script src="http://172.31.73.236/assets/sm3.js"></script>
  <script>
    // 模拟POST请求的函数
    function mockPost(params) {
      return new Promise((resolve, reject) => {
        // 模拟网络请求
        setTimeout(() => {
          // 随机返回成功或失败的结果
          if (Math.random() > 0.5) {
            resolve({status: "success", message: "注册成功", code: 200});
          } else {
            reject({status: "error", message: "系统异常，注册失败", code: 500});
          }
        }, 500);
      });
    }

    function receiveSuccess(response) {
      alert(
        `提交状态: ${response.status}, 消息:${response.message}, 代码: ${response.code}`
      );
    }

    function receiveError(response) {
      alert(`提交失败: ${response.message}`);
    }

    window.receiveSuccess = receiveSuccess;
    window.receiveError = receiveError;

    // 使用SHA-256加密
    function sha256Encrypt(password) {
      return CryptoJS.SHA256(password).toString();
    }
  </script>
</head>
<body>
<fieldset>
  <legend>
    <h2>用户注册</h2>
  </legend>

  <div class="form-group">
    <label for="stuid">学 号</label>
    <!-- 保持下面的类型text -->
    <input type="text" id="stuid" class="form-control"/>
  </div>

  <div class="form-group">
    <label for="password">密 码</label>
    <input type="password" id="password" class="form-control"/>
  </div>

  <div class="button-box">
    <button id="submit" class="btn">提交</button>
    <button id="reset" class="btn">重置</button>
  </div>
</fieldset>

<script>
  // 添加点击事件监听器
  document.getElementById("submit").addEventListener("click", handleSubmit);
  document.getElementById("reset").addEventListener("click", handleReset);

  //提交表单
  function handleSubmit() {
    var stuid = document.getElementById("stuid").value;
    var password = document.getElementById("password").value;

    if (validate(stuid, password)) {
      var encryptedPassword = sha256Encrypt(password);
      mockPost({stuid: stuid, password: encryptedPassword}).then(receiveSuccess).catch(receiveError);
    }
  }

  // 重置表单
  function handleReset() {
    var resetConfirmed = confirm("确认重置表单吗？");
    if (resetConfirmed) {
      // 清空学号和密码输入框内容
      document.getElementById("stuid").value = "";
      document.getElementById("password").value = "";
    }
  }

  // 判断表单合法性
  function validate(stuid, password) {
    let errorMessage = "";
    let flag = true;

    if (stuid.trim() === "") {
      flag = false;
      if (errorMessage === "")
        document.getElementById("stuid").focus();
      else
        errorMessage += "、";
      errorMessage += "学号不能为空";
    }

    if (stuid.length !== 10) {
      flag = false;
      if (errorMessage === "")
        document.getElementById("stuid").focus();
      else
        errorMessage += "、";
      errorMessage += "学号长度应为10位数字";
    }

    if (stuid.length !== 10) {
      flag = false;
      if (errorMessage === "")
        document.getElementById("stuid").focus();
      else
        errorMessage += "、";
      errorMessage += "学号长度应为10位数字";
    }

    if (!/^[0-9]*$/.test(stuid)) {
      flag = false;
      if (errorMessage === "")
        document.getElementById("stuid").focus();
      else
        errorMessage += "、";
      errorMessage += "学号仅能包含数字";
    }

    if (password.trim() === "") {
      flag = false;
      if (errorMessage === "")
        document.getElementById("password").focus();
      else
        errorMessage += "、";
      errorMessage += "密码不能为空";
    }

    if (!/[a-zA-Z\d!@#$%^&*]{8,20}$/.test(password)) {
      flag = false;
      if (errorMessage === "")
        document.getElementById("password").focus();
      else
        errorMessage += "、";
      errorMessage += "密码长度应为8-20个字符";
    }

    // 检查密码长度是否在8到20个字符之间，且包含字母、数字或特殊字符中的两种及以上
    if (/^(?=.*[a-z])/.test(password) + /(?=.*[A-Z])/.test(password) +
      /(?=.*\d)/.test(password) + /(?=.*[!@#$%^&*])/.test(password) < 2) {
      flag = false;
      if (errorMessage === "")
        document.getElementById("password").focus();
      else
        errorMessage += "、";
      errorMessage += "密码长度应为8-20个字符，且需包含字母、数字或特殊字符中的两种及以上";
    }

    if (errorMessage !== "")
      alert(errorMessage);

    return flag;
  }
</script>
</body>
</html>
